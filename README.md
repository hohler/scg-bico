# Big Commit Analysis #

## Environment of developer ##
- Eclipse Java EE 4.6
- Tomcat Server 9.0
- MySQL Server 5.7
- Java Version 1.8

## Setup ##

You need a MySQL and a Tomcat Server.

Additional MySQL configuration variables: see chapter 7.

### Outline ###

1. Clone repo
2. Import in Eclipse
3. Update configuration
4. Set up a local Tomcat Server Version >= 6 (Version <= 7 with Eclipse) and add it in the Run Configurations in Eclipse
5. Deploy the project to the Tomcat server
6. Example repositories
7. MySQL configuration
8. Deployment for production environment

## 1. & 2. ##
Trivial
## 3. Update configuration ##
Adapt database parameters in file
`/src/main/resources/application.properties`


	bico.db.url = jdbc:mysql://localhost:3306/bico?autoReconnect=true
	bico.db.username = bico
	bico.db.password = bico
	bico.db.driverClassName = com.mysql.jdbc.Driver


Adapt path for cloning repositories in file
`/src/main/java/org/springframework/batch/admin/sample/repository/GitLoader.java`

	private static String REPOSITORY_PATH = "target/repositories/";

With Eclipse on Windows, this is equivalent to *C:\eclipse\target\repositories\*

## 4. & 5. ##
After deploying, navigate to [http://localhost:8080/scg-bico/](http://localhost:8080/scg-bico/)

## 6. Example repositories and tips ##

** Apache Flume **

Amount of commits: ~1'700

URL: https://github.com/apache/flume.git

Type: JIRA

Issue Tracker: https://issues.apache.org/jira/si/jira.issueviews:issue-xml/%s/%s.xml

Time measurements:
- batch process without cloning: 3 minutes

** Apache Lucene-Solr **

Amount of commits: ~26'000

URL: https://github.com/apache/lucene-solr.git

Type: JIRA

Issue Tracker: https://issues.apache.org/jira/si/jira.issueviews:issue-xml/%s/%s.xml

Time measurements:
- no data

** Apache Nutch **

Amount of commits: ~2'222

URL: https://github.com/apache/nutch.git

Type: JIRA

Issue Tracker: https://issues.apache.org/jira/si/jira.issueviews:issue-xml/%s/%s.xml

Time measurements:
- no data

** Hibernate Search **

Amount of commits: ~4'800

URL: https://github.com/hibernate/hibernate-search.git

Type: JIRA

Issue Tracker: https://hibernate.atlassian.net/si/jira.issueviews:issue-xml/%s/%s.xml

Time measurements:
- no data

** elasticsearch **

Amount of commits: ~25'560

URL: https://github.com/elastic/elasticsearch.git

Type: GitHub

Issue Tracker: https://github.com/elastic/elasticsearch 

Time measurements:
- about 1 hour without cloning
- no data

** Apache httpclient **

Amount of commits: ~2'650 

URL: https://github.com/apache/httpclient.git

Type: JIRA

Issue Tracker: https://issues.apache.org/jira/si/jira.issueviews:issue-xml/%s/%s.xml

Time measurements:
-no data

## 7. MySQL Configuration ##
MySQL specific configuration: some patches are too big. You have to set the max_allowed_packets higher in your MySQL Server configuration. e.g. `max_allowed_packet=20M`.

Also, `innodb_buffer_pool_size` should be raised to 32M.

Location of configuration file on Windows: `C:\ProgramData\MySQL\MySQL Server 5.7\my.ini`

## 8. Deployment for production environment ##
** Generation of .war file with Maven (in project directory): **

Change the configuration files (see above) according to your environment.

	mvn clean install -X

** Generation of .war file with Eclipse: **

Project -> Run as -> "Maven build..."
-> Goals: clean install -X
-> JRE: set Java 1.8 JDK
-> Execute

** Deploy the .war file to a Tomcat Server. **

.war File is located in /target/

Copy .war file to /webapps/ folder of Tomcat.

Tables for Spring batch should get auto-generated. If not, `db_structure.sql` is included in the base git directory.

Tables for the App itself are not auto-generated by default. If you want that they are auto-generated, go to file `WEB-INF/applicationContext.xml` and set `generateDdl` in entityManagerFactory bean to true. Pay attention: On every app start, the tables are re-created.

I recommend to just import the db_structure.sql and don't touch `generateDdl`.